{% load widget_tweaks %}

<script>
    document.getElementById('modalTitle').textContent = '{% if rack.location %}Edytuj synchronizację regału{% else %}Synchronizuj regał z WMS{% endif %}';
</script>

{% if rack.location %}
<div class="alert alert-info mb-3">
    <i class="fas fa-info-circle me-2"></i>
    Regał jest zsynchronizowany z lokalizacją: <strong>{{ rack.location.name }}</strong> ({{ rack.location.barcode }})
</div>
{% else %}
<div class="alert alert-warning mb-3">
    <i class="fas fa-exclamation-triangle me-2"></i>
    Regał nie jest zsynchronizowany z systemem WMS.
</div>
{% endif %}

<form hx-post="{% url 'wms_builder:htmx_rack_sync_to_location' rack.id %}"
      hx-target="body"
      hx-swap="none"
      hx-on::after-request="if(event.detail.xhr.status === 204) { htmx.trigger('body', 'modalHide'); }">
    {% csrf_token %}
    
    <div class="mb-3">
        <p class="text-muted">Kod kreskowy zostanie wygenerowany automatycznie na podstawie ID regału i strefy.</p>
        {% if form.non_field_errors %}
            <div class="alert alert-danger">
                {% for error in form.non_field_errors %}
                    <div>{{ error }}</div>
                {% endfor %}
            </div>
        {% endif %}
    </div>
    
    <div class="d-flex justify-content-end">
        <button type="button" class="btn btn-secondary me-2" data-bs-dismiss="modal">Anuluj</button>
        <button type="submit" class="btn btn-primary">Synchronizuj</button>
    </div>
</form>

