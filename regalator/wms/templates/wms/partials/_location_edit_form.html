{% load widget_tweaks %}

{% if error %}
<div class="alert alert-danger" role="alert">
    <i class="fas fa-exclamation-triangle me-2"></i>{{ error }}
</div>
{% endif %}

{# Breadcrumbs dla bieżącej lokalizacji #}
{% if location_breadcrumbs %}
<nav aria-label="Ścieżka lokalizacji" class="mb-4 pb-3 border-bottom">
    <ol class="breadcrumb small mb-0">
        {% for crumb in location_breadcrumbs %}
            <li class="breadcrumb-item {% if forloop.last %}active{% endif %}" {% if forloop.last %}aria-current="page"{% endif %}>
                <a href="#"
                   class="{% if forloop.last %}text-body{% else %}text-muted{% endif %}"
                   style="text-decoration: none;"
                   hx-get="{% url 'wms:htmx_location_edit' crumb.id %}"
                   hx-target="#modalBody"
                   hx-swap="innerHTML"
                   hx-trigger="click">
                    {% if crumb.location_type == 'zone' %}
                        <i class="fas fa-map me-1"></i>
                    {% elif crumb.location_type == 'rack' %}
                        <i class="fas fa-cubes me-1"></i>
                    {% elif crumb.location_type == 'shelf' %}
                        <i class="fas fa-layer-group me-1"></i>
                    {% else %}
                        <i class="fas fa-map-marker-alt me-1"></i>
                    {% endif %}
                    {{ crumb.name }}
                </a>
            </li>
        {% endfor %}
    </ol>
</nav>
{% endif %}

<form class="location-edit-form mt-3" hx-post="{% if location %}{% url 'wms:htmx_location_edit' location.id %}{% else %}{% url 'wms:htmx_location_create' %}{% endif %}" hx-swap="outerHTML">
    {% csrf_token %}
    {{ form.is_active }}
    <div class="row g-3">
        <div class="col-md-6">
            <label for="{{ form.name.id_for_label }}" class="form-label">{{ form.name.label }}</label>
            {% render_field form.name %}
            {% if form.name.errors %}
                <div class="invalid-feedback d-block">
                    {% for error in form.name.errors %}
                        {{ error }}
                    {% endfor %}
                </div>
            {% endif %}
        </div>
        <div class="col-md-6">
            <label for="{{ form.barcode.id_for_label }}" class="form-label">{{ form.barcode.label }}</label>
            <div class="barcode-field">
                {% render_field form.barcode class="form-control barcode-field" %}
            </div>
            {% if form.barcode.errors %}
                <div class="invalid-feedback d-block">
                    {% for error in form.barcode.errors %}
                        {{ error }}
                    {% endfor %}
                </div>
            {% endif %}
        </div>
        <div class="col-12">
            <label for="{{ form.description.id_for_label }}" class="form-label">{{ form.description.label }}</label>
            {% render_field form.description %}
            {% if form.description.errors %}
                <div class="invalid-feedback d-block">
                    {% for error in form.description.errors %}
                        {{ error }}
                    {% endfor %}
                </div>
            {% endif %}
        </div>
        <div class="col-12">
            <div class="d-flex gap-2">
                <button type="submit" class="btn btn-primary">
                    <i class="fas fa-save me-1"></i>Zapisz
                </button>
                <button type="button" class="btn btn-secondary" 
                        data-bs-dismiss="modal">
                    <i class="fas fa-times me-1"></i>Anuluj
                </button>
                {% if location %}
                <a href="{% url 'wms:stock_list_by_location' location.id %}" 
                   class="btn btn-outline-primary ms-auto"
                   target="_blank">
                    <i class="fas fa-warehouse me-1"></i>Stany magazynowe
                </a>
                <button type="button" class="btn btn-outline-primary" 
                        hx-get="{% url 'wms:htmx_location_photos' location.id %}"
                        hx-swap="innerHTML"
                        hx-target="#modalBody">
                    <i class="fas fa-images me-1"></i>Zarządzaj zdjęciami
                </button>
                {% endif %}
            </div>
        </div>
    </div>
</form>
