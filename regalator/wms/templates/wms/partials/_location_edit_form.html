{% load widget_tweaks %}

{% if error %}
<div class="alert alert-danger" role="alert">
    <i class="fas fa-exclamation-triangle me-2"></i>{{ error }}
</div>
{% endif %}

<form class="location-edit-form" hx-post="{% if location %}{% url 'wms:htmx_location_edit' location.id %}{% else %}{% url 'wms:htmx_location_create' %}{% endif %}" hx-swap="outerHTML">
    {% csrf_token %}
    {{ form.is_active }}
    <div class="row g-3">
        <div class="col-md-6">
            <label for="{{ form.name.id_for_label }}" class="form-label">{{ form.name.label }}</label>
            {% render_field form.name %}
            {% if form.name.errors %}
                <div class="invalid-feedback d-block">
                    {% for error in form.name.errors %}
                        {{ error }}
                    {% endfor %}
                </div>
            {% endif %}
        </div>
        <div class="col-md-6">
            <label for="{{ form.barcode.id_for_label }}" class="form-label">{{ form.barcode.label }}</label>
            <div class="barcode-field">
                {% render_field form.barcode class="form-control barcode-field" %}
            </div>
            {% if form.barcode.errors %}
                <div class="invalid-feedback d-block">
                    {% for error in form.barcode.errors %}
                        {{ error }}
                    {% endfor %}
                </div>
            {% endif %}
        </div>
        <div class="col-md-6">
            <label for="{{ form.location_type.id_for_label }}" class="form-label">{{ form.location_type.label }}</label>
            {% render_field form.location_type %}
            {% if form.location_type.errors %}
                <div class="invalid-feedback d-block">
                    {% for error in form.location_type.errors %}
                        {{ error }}
                    {% endfor %}
                </div>
            {% endif %}
        </div>
        <div class="col-md-6">
            <label for="{{ form.parent.id_for_label }}" class="form-label">{{ form.parent.label }}</label>
            {% render_field form.parent %}
            {% if form.parent.errors %}
                <div class="invalid-feedback d-block">
                    {% for error in form.parent.errors %}
                        {{ error }}
                    {% endfor %}
                </div>
            {% endif %}
        </div>
        <div class="col-12">
            <label for="{{ form.description.id_for_label }}" class="form-label">{{ form.description.label }}</label>
            {% render_field form.description %}
            {% if form.description.errors %}
                <div class="invalid-feedback d-block">
                    {% for error in form.description.errors %}
                        {{ error }}
                    {% endfor %}
                </div>
            {% endif %}
        </div>
        <div class="col-12">
            <div class="d-flex gap-2">
                <button type="submit" class="btn btn-primary">
                    <i class="fas fa-save me-1"></i>Zapisz
                </button>
                <button type="button" class="btn btn-secondary" 
                        data-bs-dismiss="modal">
                    <i class="fas fa-times me-1"></i>Anuluj
                </button>
                {% if location %}
                <button type="button" class="btn btn-outline-primary ms-auto" 
                        hx-get="{% url 'wms:htmx_location_photos' location.id %}"
                        hx-swap="innerHTML"
                        hx-target="#modalBody">
                    <i class="fas fa-images me-1"></i>Zarządzaj zdjęciami
                </button>
                {% endif %}
            </div>
        </div>
    </div>
</form>
