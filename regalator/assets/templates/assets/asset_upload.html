{% extends 'assets/base.html' %}

{% block title %}Dodaj Asset - Asset Manager{% endblock %}

{% block content %}
<div class="row">
    <div class="col-12">
        <div class="d-flex justify-content-between align-items-center mb-4">
            <h1>
                <i class="fas fa-upload me-2"></i>Dodaj Asset
            </h1>
            <a href="{% url 'assets:asset_list' %}" class="btn btn-outline-secondary">
                <i class="fas fa-arrow-left me-1"></i>Powrót
            </a>
        </div>
    </div>
</div>

<div class="row">
    <div class="col-lg-8">
        <div class="card">
            <div class="card-header">
                <h5 class="mb-0">
                    <i class="fas fa-file-upload me-2"></i>Formularz uploadu
                </h5>
            </div>
            <div class="card-body">
                <form method="post" enctype="multipart/form-data" id="uploadForm">
                    {% csrf_token %}
                    
                    <div class="row">
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="{{ form.title.id_for_label }}" class="form-label">
                                    <i class="fas fa-heading me-1"></i>Tytuł *
                                </label>
                                {{ form.title }}
                                {% if form.title.errors %}
                                    <div class="text-danger small">{{ form.title.errors }}</div>
                                {% endif %}
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="{{ form.file_type.id_for_label }}" class="form-label">
                                    <i class="fas fa-tag me-1"></i>Typ pliku
                                </label>
                                {{ form.file_type }}
                                {% if form.file_type.errors %}
                                    <div class="text-danger small">{{ form.file_type.errors }}</div>
                                {% endif %}
                                <small class="text-muted">Zostanie określony automatycznie na podstawie rozszerzenia pliku</small>
                            </div>
                        </div>
                    </div>
                    
                    <div class="mb-3">
                        <label for="{{ form.description.id_for_label }}" class="form-label">
                            <i class="fas fa-align-left me-1"></i>Opis
                        </label>
                        {{ form.description }}
                        {% if form.description.errors %}
                            <div class="text-danger small">{{ form.description.errors }}</div>
                        {% endif %}
                    </div>
                    
                    <div class="row">
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="{{ form.category.id_for_label }}" class="form-label">
                                    <i class="fas fa-folder me-1"></i>Kategoria
                                </label>
                                {{ form.category }}
                                {% if form.category.errors %}
                                    <div class="text-danger small">{{ form.category.errors }}</div>
                                {% endif %}
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="{{ form.tags.id_for_label }}" class="form-label">
                                    <i class="fas fa-tags me-1"></i>Tagi
                                </label>
                                {{ form.tags }}
                                {% if form.tags.errors %}
                                    <div class="text-danger small">{{ form.tags.errors }}</div>
                                {% endif %}
                                <small class="text-muted">Przytrzymaj Ctrl/Cmd aby wybrać wiele tagów</small>
                            </div>
                        </div>
                    </div>
                    
                    <div class="mb-3">
                        <label for="{{ form.file.id_for_label }}" class="form-label">
                            <i class="fas fa-file me-1"></i>Plik *
                        </label>
                        <div class="drop-zone" id="dropZone">
                            <div class="drop-zone-text">
                                <i class="fas fa-cloud-upload-alt fa-3x text-muted mb-3"></i>
                                <h5>Przeciągnij plik tutaj lub kliknij aby wybrać</h5>
                                <p class="text-muted">Obsługiwane formaty: obrazy, PDF, dokumenty, wideo, audio</p>
                            </div>
                            {{ form.file }}
                        </div>
                        {% if form.file.errors %}
                            <div class="text-danger small">{{ form.file.errors }}</div>
                        {% endif %}
                    </div>
                    
                    <div class="mb-3">
                        <div class="form-check">
                            {{ form.is_public }}
                            <label class="form-check-label" for="{{ form.is_public.id_for_label }}">
                                <i class="fas fa-globe me-1"></i>Asset publiczny
                            </label>
                        </div>
                        {% if form.is_public.errors %}
                            <div class="text-danger small">{{ form.is_public.errors }}</div>
                        {% endif %}
                    </div>
                    
                    <div class="mb-3">
                        <div class="form-check">
                            {{ form.is_splash_image }}
                            <label class="form-check-label" for="{{ form.is_splash_image.id_for_label }}">
                                <i class="fas fa-image me-1"></i>Użyj jako obraz splash
                            </label>
                        </div>
                        {% if form.is_splash_image.errors %}
                            <div class="text-danger small">{{ form.is_splash_image.errors }}</div>
                        {% endif %}
                        <small class="text-muted">Obraz splash będzie wyświetlany na głównej stronie WMS</small>
                    </div>
                    
                    <div class="d-grid gap-2 d-md-flex justify-content-md-end">
                        <button type="submit" class="btn btn-primary">
                            <i class="fas fa-upload me-1"></i>Dodaj Asset
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>
    
    <div class="col-lg-4">
        <div class="card">
            <div class="card-header">
                <h6 class="mb-0">
                    <i class="fas fa-info-circle me-2"></i>Informacje
                </h6>
            </div>
            <div class="card-body">
                <h6>Obsługiwane formaty:</h6>
                <ul class="list-unstyled">
                    <li><i class="fas fa-image text-primary me-2"></i>Obrazy: JPG, PNG, GIF, BMP, WebP</li>
                    <li><i class="fas fa-file-pdf text-danger me-2"></i>PDF</li>
                    <li><i class="fas fa-file-word text-primary me-2"></i>Dokumenty: DOC, DOCX, TXT, RTF</li>
                    <li><i class="fas fa-file-video text-warning me-2"></i>Wideo: MP4, AVI, MOV, WMV</li>
                    <li><i class="fas fa-file-audio text-success me-2"></i>Audio: MP3, WAV, OGG</li>
                </ul>
                
                <hr>
                
                <h6>Maksymalny rozmiar pliku:</h6>
                <p class="text-muted">10 MB</p>
                
                <hr>
                
                <h6>Wskazówki:</h6>
                <ul class="list-unstyled small">
                    <li><i class="fas fa-lightbulb text-warning me-2"></i>Dodaj opisowe tagi dla łatwiejszego wyszukiwania</li>
                    <li><i class="fas fa-lightbulb text-warning me-2"></i>Wybierz odpowiednią kategorię</li>
                    <li><i class="fas fa-lightbulb text-warning me-2"></i>Użyj znaczącego tytułu</li>
                </ul>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_css %}
<style>
    .drop-zone {
        border: 2px dashed #dee2e6;
        border-radius: 0.375rem;
        padding: 2rem;
        text-align: center;
        transition: border-color 0.3s ease;
        cursor: pointer;
        position: relative;
    }
    
    .drop-zone:hover {
        border-color: #0d6efd;
    }
    
    .drop-zone.dragover {
        border-color: #0d6efd;
        background-color: #f8f9fa;
    }
    
    .drop-zone input[type="file"] {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        opacity: 0;
        cursor: pointer;
    }
    
    .drop-zone-text {
        pointer-events: none;
    }
</style>
{% endblock %}

{% block extra_js %}
<script>
    // Drag & Drop functionality
    const dropZone = document.getElementById('dropZone');
    const fileInput = dropZone.querySelector('input[type="file"]');
    
    dropZone.addEventListener('click', () => {
        fileInput.click();
    });
    
    dropZone.addEventListener('dragover', (e) => {
        e.preventDefault();
        dropZone.classList.add('dragover');
    });
    
    dropZone.addEventListener('dragleave', () => {
        dropZone.classList.remove('dragover');
    });
    
    dropZone.addEventListener('drop', (e) => {
        e.preventDefault();
        dropZone.classList.remove('dragover');
        
        const files = e.dataTransfer.files;
        if (files.length > 0) {
            fileInput.files = files;
            updateFileName(files[0].name);
        }
    });
    
    fileInput.addEventListener('change', (e) => {
        if (e.target.files.length > 0) {
            updateFileName(e.target.files[0].name);
        }
    });
    
    function updateFileName(fileName) {
        const dropZoneText = dropZone.querySelector('.drop-zone-text');
        dropZoneText.innerHTML = `
            <i class="fas fa-check-circle fa-3x text-success mb-3"></i>
            <h5>Wybrany plik:</h5>
            <p class="text-primary">${fileName}</p>
        `;
    }
</script>
{% endblock %} 